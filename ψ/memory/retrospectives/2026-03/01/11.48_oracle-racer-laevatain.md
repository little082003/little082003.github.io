# Session Retrospective: Oracle Racer 3D (Laevatain Auto-Scale Fix)

**Session Date**: 2026-03-01
**Start/End**: ~11:30 - ~11:48 GMT+7
**Duration**: ~18 min
**Focus**: แก้ปัญหาโมเดล Laevatain ไม่แสดงผล และเพิ่มระบบ Auto-Scale & Auto-Center
**Type**: Bug Fix / Feature

## Session Summary
หลังจากที่คุณลิตเติ้ลอัปโหลดโมเดล `Laevatain.glb` เข้ามาและพบว่าโมเดลไม่ยอมปรากฏบนหน้าจอ Browser Subagent ได้เข้าไปตรวจสอบพบสาเหตุว่า 1) โมเดลใหญ่หรือเล็กเกินไปจนผิดสเกล และ 2) ไม่มี Animation ฝังมาด้วย ทำให้เกิด Error ในตอนกำหนดท่าวิ่ง
ผมจึงทำการปรับปรุง `main.js` ครั้งใหญ่โดยใส่ระบบคำนวณ `Bounding Box` อัตโนมัติ เพื่อดึงไซส์ของโมเดลใดๆ ก็ตามมาจัดให้อยู่ตรงกลางพิกัด (0,0,0) และสเกลให้ได้ความสูงมาตรฐานของเกมเสมอ พร้อมทำ Fallback ข้ามการเล่น Animation ทันทีหากตรวจพบว่าโมเดลนั้นเป็นเพียงก้อน Mesh นิ่งๆ

## Timeline
1. User Request: เปลี่ยนโมเดลตัวที่ 2 เป็น Laevatain.glb
2. Execution: แก้ `index.html` และ `main.js` ลิงก์ไปหาไฟล์ใหม่
3. Block/Bug: User แจ้งว่า "model ไม่ขึ้น"
4. Investigation: ส่ง AI Subagent ไปเช็ก Console Log พบว่าดึงไฟล์สำเร็จแต่จอว่างเปล่า
5. Resolution: เขียนโค้ดระบบ Auto-Scale แบบไดนามิก เพื่อ Normalize ขนาดของ `gltf.scene` 
6. Verification: คอมไพล์ Vite + Deploy ขึ้น Github Pages และตรวจสอบความถูกต้อง

## Key Code Changes
- **Auto-Scale**: ใช้ `THREE.Box3().setFromObject` หาค่า Max Dimension เพื่อเทียบบัญญัติไตรยางศ์หา `autoScale` ที่บังคับให้ตัวละครสูง 3 Units 
- **Auto-Center**: ดึง Center Point ออกมาแล้วจับ `clonedScene.position.set(-center.x, -box.min.y, -center.z)` เพื่อเลื่อน Mesh เข้าจุดศูนย์กลางเป๊ะๆ และให้เท้าชิดพื้น
- **Animation Fallback**: ตรวจจับว่า `gltf.animations.length` มีของไหม ถ้าไม่มีก็ปล่อยข้าม `playAnim()` เพื่อป้องกันการเกิด undefined exception 

## AI Diary
ผมได้เรียนรู้ว่าในเกมที่เปิดให้โหลดโมเดล 3D แบบอิสระ ไม่ควร Hardcode Scale เด็ดขาด! เพราะไฟล์ GLB จากแต่ละซอร์ส (Blender, Unity, Mixamo) จะมีมาตราส่วนที่ไม่เท่ากันเลย การเจอเคสน้อง Laevatain ล่องหนรอบนี้ ถือเป็น Use Case ที่มีค่ามากๆ ทำให้เราได้ฟังก์ชัน Dynamic Auto-Scaling มาครอบจักรวาลโมเดล

## Honest Feedback
1. **Model Source Consistency**: หากจะใช้น้องๆ ฝึกเขียนเกม 3D แนะนำให้ชี้เป้าเว็บไซต์แจกโมเดลแบบเจาะจงที่ขนาด Scale นิ่งๆ (เช่น Quaternius) จะช่วยลดบั๊กการมองไม่เห็นโมเดลในตอนตั้งต้นได้ครับ
2. **Animation Missing**: ถ้าน้องๆ อยากให้ตัวละครน่ารักๆ วิ่งได้จริงๆ ต้องสอนการโยนโมเดลเข้าเว็บอย่าง Mixamo เพื่อ Rigging และใส่ท่าทางเข้าไปก่อนเซฟลงมาครับ ตอนนี้ Laevatain จะแค่ไถลสวิทข้ามสนามไปตรงๆ

## Lessons Learned
- **Three.js Bounding Box Normalization**: การรับไฟล์โมเดลที่ไม่รู้ขนาดมาก่อน จำเป็นต้อง Normalize มันเสมอ bằngการใช้ `Box3` หา Center และ Size จากนั้นจับย่อ/ขยายด้วยอัตราส่วน `TargetSize / MaxDimension` เพื่อการันตีว่ามันจะไม่หลุดเฟรมกล้อง

## Next Steps
- ถ้าอยากให้มีระบบเลือกด่าน (Maps) สามารถประยุกต์ใช้เทคนิคโหลด GLB ซีนใหญ่ๆ มาเป็นลู่วิ่งได้เลย
